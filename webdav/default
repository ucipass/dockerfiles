dav_ext_lock_zone zone=foo:10m;
rewrite_log on;
error_log /dev/stdout info;

server {
    listen 80 default_server;
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {


		set $destination $http_destination;
		set $parse "";

		if ($request_method = MKCOL) {
			set $parse "MKCOL";
		}

		if ($request_method = MOVE) {
			set $parse "MOVECOPY";
		}

		if ($request_method = COPY) {
			set $parse "MOVECOPY";
		}

		if ($request_method = DELETE) {
			set $parse "DELETE";
		}

		if ($request_method = PROPFIND) {
			set $parse "PROPFIND";
		}

		if (-d $request_filename) {
			set $parse "${parse}DIR";
		}

		if ($parse ~ ^MKCOL$) {
			rewrite ^(.*[^/])$ $1/ break;
		}

		if ($parse ~ ^DELETEDIR$) {
			rewrite ^(.*[^/])$ $1/ break;
		}

		if ($parse ~ ^PROPFINDDIR$) {
			rewrite ^(.*[^/])$ $1/ break;
		}

		if ($parse ~ ^MOVECOPYDIR$) {
			more_set_input_headers "Destination: $destination/";
			rewrite ^(.*[^/])$ $1/ break;
		}

	

		#auth_basic "Restricted";
        #auth_basic_user_file /etc/nginx/webdavpasswd;
        dav_ext_lock zone=foo;
        dav_methods PUT DELETE MKCOL COPY MOVE;
        dav_ext_methods PROPFIND OPTIONS LOCK UNLOCK;
        create_full_put_path on;

    }


}